<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tile Load Events</title>
  <style>
      .map {
        width: 100%;
        height: 400px;
      }
      .map {
        background: #85ccf9;
      }
      .wrapper {
        position: relative;
      }
      #progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 0;
        box-shadow: 0px 0px 1px 2px rgb(255,204,0);
        width: 0;
        transition: width 250ms;
      }
    </style>
<script src="/ol/dist/ol.js"></script>
<script src="/js/jquery-3.6.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="/ol/ol.css">
<script type="text/javascript">
$(document).ready(function() {

   /**
    * Renders a progress bar.
    * @param {HTMLElement} el The target element.
    * @class
    */
   function Progress(el) {
     this.el = el;
     this.loading = 0;
     this.loaded = 0;
   }

   /**
    * Increment the count of loading tiles.
    */
   Progress.prototype.addLoading = function () {
     ++this.loading;
     this.update();
   };

   /**
    * Increment the count of loaded tiles.
    */
   Progress.prototype.addLoaded = function () {
     ++this.loaded;
     this.update();
   };

   /**
    * Update the progress bar.
    */
   Progress.prototype.update = function () {
     const width = ((this.loaded / this.loading) * 100).toFixed(1) + '%';
     this.el.style.width = width;
   };

   /**
    * Show the progress bar.
    */
   Progress.prototype.show = function () {
     this.el.style.visibility = 'visible';
   };

   /**
    * Hide the progress bar.
    */
   Progress.prototype.hide = function () {
     const style = this.el.style;
     setTimeout(function () {
       style.visibility = 'hidden';
       style.width = 0;
     }, 250);
   };

   const progress = new Progress(document.getElementById('progress'));

   const key = 'aHyqnlpCDhwjzbtKnXvq';
   const attributions =
     '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> ' +
     '<a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>';

   const source = new ol.source.XYZ({
     attributions: attributions,
     url: 'https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=' + key,
     tileSize: 512,
   });

   source.on('tileloadstart', function () {
     progress.addLoading();
   });
   source.on(['tileloadend', 'tileloaderror'], function () {
     progress.addLoaded();
   });

   const map = new ol.Map({
     layers: [new ol.layer.Tile({source: source})],
     target: 'map',
     view: new ol.View({
       center: [0, 0],
       zoom: 2,
     }),
   });

   map.on('loadstart', function () {
     progress.show();
   });
   map.on('loadend', function () {
     progress.hide();
   });
   });

</script>

</head>
<body>
 	<h2>TileLoadEvents</h2>
  	<h5>(주)이쓰리 이대교 주임</h5>
<div id="map" class="map"></div>
<div id="progress"></div>
</body>
</html>